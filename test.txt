import dash
from dash import html, dcc, dash_table
from dash.dependencies import ClientsideFunction, Input, Output, State
import pandas as pd

# Przyk≈Çadowe dane
data = pd.DataFrame({
    'ID': [1, 2, 3],
    'Name': ['Alice', 'Bob', 'Charlie']
})

app = dash.Dash(__name__)

app.layout = html.Div([
    dash_table.DataTable(
        id='table',
        columns=[{"name": i, "id": i} for i in data.columns],
        data=data.to_dict('records'),
        editable=True
    ),
    html.Div(id='dummy-div')  # Pusty div dla callbacku
])

# Clientside callback do automatycznego zapisywania
app.clientside_callback(
    """
    function(data) {
        var table = document.getElementById('table');
        if (table) {
            var editableCells = table.getElementsByClassName('dash-cell-value');

            for (var i = 0; i < editableCells.length; i++) {
                editableCells[i].addEventListener('blur', function(event) {
                    var cell = event.target;
                    cell.dispatchEvent(new KeyboardEvent('keydown', {'key': 'Enter'}));
                });
            }
        }
    }
    """,
    Output('dummy-div', 'children'),
    [Input('table', 'data_timestamp')],
    [State('table', 'data')]
)

if __name__ == '__main__':
    app.run_server(debug=True)
